# План разработки игры (Версия 0.01)

## Цель
Разработать прототип ASCII-игры на C# с использованием библиотеки Raylib.

## Этапы разработки:

1.  **Инициализация проекта и настройка Raylib:**
    *   Создание нового консольного проекта C#.
    *   Установка и настройка библиотеки Raylib (через NuGet-пакет `Raylib-cs`).

2.  **Создание базового окна игры:**
    *   Инициализация окна Raylib с заданными размерами и заголовком.

3.  **Реализация основного игрового цикла:**
    *   Обработка событий (ввод пользователя).
    *   Обновление состояния игры.
    *   Отрисовка игровых элементов.

4.  **Настройка отрисовки базовой ASCII-графики:**
    *   Использование шрифтов, способных отображать ASCII-символы.
    *   Отрисовка символов и строк с заданными координатами и цветом.

5.  **Создание и отображение персонажа игрока:**
    *   Определение класса/структуры для персонажа игрока (позиция, символ, цвет).
    *   Отрисовка персонажа на экране.

6.  **Реализация обработки ввода с клавиатуры для перемещения персонажа:**
    *   Обработка нажатий клавиш (например, стрелки или WASD) для изменения позиции персонажа.

7.  **Создание простой статической карты с использованием ASCII-символов:**
    *   Определение структуры данных для карты (например, двумерный массив символов).
    *   Отрисовка карты на экране.

8.  **Реализация базового обнаружения столкновений персонажа с картой:**
    *   Проверка возможности перемещения персонажа в новую позицию на основе карты (например, нельзя пройти сквозь 'стены').

## Статус разработки

*   **Версия 0.01:** Завершена.

---

# План разработки версии 0.02: Внедрение ИИ-управления и переключения режимов

**Цель:** Добавить в игру возможность управления персонажем с помощью искусственного интеллекта (ИИ), а также предоставить пользователю механизм для переключения между ручным управлением и автоматическим управлением ИИ.

**Ключевые особенности версии 0.02:**
*   Возможность игрового ИИ брать на себя управление персонажем.
*   Сохранение функциональности ручного управления.
*   Механизм переключения между ручным и ИИ-управлением во время игры.

---

### Подробный план реализации:

**Шаг 1: Определение интерфейса контроллера**
*   **Действие:** Создать новый файл `IPlayerController.cs`.
*   **Содержимое:** Определить интерфейс `IPlayerController` с единственным методом:
    ```csharp
    public interface IPlayerController
    {
        void Update(Player player, GameMap map);
    }
    ```
*   **Назначение:** Этот интерфейс позволит унифицировать взаимодействие с различными типами контроллеров (ручным и ИИ) в игровом цикле.

**Шаг 2: Реализация ручного контроллера**
*   **Действие:** Создать новый файл `ManualPlayerController.cs`.
*   **Содержимое:** Создать класс `ManualPlayerController`, который реализует `IPlayerController`. В его методе `Update` будет инкапсулирована текущая логика обработки ввода с клавиатуры для перемещения игрока.
*   **Назначение:** Отделение логики ручного управления от основного игрового цикла и соответствие модульной структуре.

**Шаг 3: Реализация контроллера ИИ**
*   **Действие:** Создать новый файл `AIPlayerController.cs`.
*   **Содержимое:** Создать класс `AIPlayerController`, который также реализует `IPlayerController`. В его методе `Update` будет реализована базовая логика ИИ.
    *   **Первая итерация логики ИИ:** Простое случайное движение. ИИ будет случайным образом выбирать одно из четырех направлений (вверх, вниз, влево, вправо) и пытаться переместить игрока, проверяя наличие стен на `GameMap`.
    *   **Механизм задержки:** Добавить небольшую задержку между действиями ИИ (например, движение раз в 10-20 кадров), чтобы его действия не были слишком быстрыми и хаотичными.
*   **Назначение:** Внедрение автономного управления персонажем с помощью ИИ.

**Шаг 4: Модификация основного игрового цикла (`Program.cs`)**
*   **Действие:** Изменить существующий файл `Program.cs`.
*   **Изменения:**
    *   Создать экземпляры `ManualPlayerController` и `AIPlayerController`.
    *   Объявить переменную `IPlayerController currentController`, которая будет указывать на активный контроллер (по умолчанию `ManualPlayerController`).
    *   Добавить логику для обработки новой клавиши (например, `KeyboardKey.KEY_A` или `KeyboardKey.KEY_SPACE`) для переключения значения `currentController` между `ManualPlayerController` и `AIPlayerController`.
    *   В основном игровом цикле `while (!Raylib.WindowShouldClose())` удалить прямую обработку ввода игрока и вместо этого вызывать `currentController.Update(player, gameMap)`.
*   **Назначение:** Интеграция нового подхода к управлению и предоставление пользователю возможности переключения режимов.

**Шаг 5: Обновление класса `Player.cs` (если потребуется)**
*   **Действие:** Провести ревизию `Player.cs`.
*   **Изменения:** Внести изменения только в случае, если выявятся новые требования или оптимизации, связанные с интеграцией контроллеров. На текущий момент ожидается, что изменения не потребуются.

**Шаг 6: Разработка и запуск тестов**
*   **Действие:** Создать новые тестовые файлы и добавить в них юнит-тесты.
*   **Тесты для `ManualPlayerController`:**
    *   `tests/GGD.Tests/ManualPlayerControllerTests.cs`
    *   Проверить, что контроллер корректно обрабатывает различные нажатия клавиш и вызывает метод `player.Move` с соответствующими параметрами.
*   **Тесты для `AIPlayerController`:**
    *   `tests/GGD.Tests/AIPlayerControllerTests.cs`
    *   Проверить, что ИИ-контроллер пытается переместить игрока (можно использовать заглушки или моки для `Player` и `GameMap`).
    *   Убедиться, что ИИ не пытается пройти сквозь стены, используя информацию от `GameMap`.
*   **Назначение:** Обеспечение качества кода и корректности работы нового функционала.

---

### Решение проблем с тестами (важные исправления)
*   **Обновление синтаксиса NUnit `Assert`:** В NUnit версии 4.2 (и выше) статические методы `Assert.AreEqual` и `Assert.AreNotEqual` были удалены. Они были заменены на более гибкий синтаксис с использованием `Assert.That(actual, Is.EqualTo(expected))` и `Assert.That(actual, Is.Not.EqualTo(expected))`. Все вызовы `Assert.AreEqual` и `Assert.AreNotEqual` в `ManualPlayerControllerTests.cs` и `AIPlayerControllerTests.cs` были заменены на новый синтаксис.
*   **Корректировка размера карты в `GameMap.cs`:** Исходный размер карты в `GameMap.cs` (40x20) не соответствовал предположениям существующих тестов, которые рассчитывали на карту 20x10. Размеры `_mapWidth` и `_mapHeight` в `GameMap.cs` были уменьшены до 20 и 10 соответственно, чтобы обеспечить корректную работу граничных проверок в тестах.

---

**Завершение:**
После успешного выполнения всех шагов и прохождения тестов, версия 0.02 будет готова.

## Статус разработки

*   **Версия 0.01:** Завершена.
*   **Версия 0.02:** Завершена.
